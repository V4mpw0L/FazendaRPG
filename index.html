<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#5caa1f" />
  <meta name="description" content="FazendaRPG - Um jogo de fazenda RPG completo para mobile" />

  <!-- iOS Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="FazendaRPG" />
  <meta name="mobile-web-app-capable" content="yes" />

  <!-- iOS Splash Screens -->
  <meta name="apple-touch-fullscreen" content="yes" />

  <title>🌾 FazendaRPG</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="./assets/icon.svg" />
  <link rel="icon" type="image/png" sizes="192x192" href="./assets/icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="./assets/icon-512.png" />

  <!-- iOS Icons - iOS não suporta SVG, precisa de PNG -->
  <link rel="apple-touch-icon" href="./assets/icon-152.png" sizes="152x152" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="./assets/icon-384.png" sizes="384x384" />
  <link rel="apple-touch-icon" href="./assets/icon-512.png" sizes="512x512" />

  <!-- Styles -->
  <link rel="stylesheet" href="style/main.css" />
  <link rel="stylesheet" href="style/topbar.css" />
  <link rel="stylesheet" href="style/skills.css" />
  <link rel="stylesheet" href="style/wiki.css" />
  <link rel="stylesheet" href="style/themes.css" />
  <link rel="stylesheet" href="style/mobile.css" />
  <link rel="stylesheet" href="style/topbar-fix.css" />
  <link rel="stylesheet" href="style/components/farm-improvements.css" />
</head>
<body class="light-theme">

  <!-- Top Bar -->
  <div id="topbar" class="topbar">
    <!-- Left Section: Avatar + Player Info -->
    <div class="topbar-left">
      <div class="topbar-avatar" id="topbar-avatar" style="cursor: pointer; overflow: hidden; border-radius: 50%;">
        <img id="topbar-avatar-img" src="assets/sprites/avatars/11.png" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
      </div>
      <div class="topbar-player">
        <h1 class="topbar-player-name" id="topbar-player-name">Fazendeiro</h1>
        <div class="topbar-player-level">Nível <span id="topbar-level">1</span></div>
        <div class="topbar-farming-xp">
          <div class="topbar-farming-bar">
            <div class="topbar-farming-fill" id="topbar-farming-fill" style="width: 0%"></div>
          </div>
          <div class="topbar-farming-text">
            <span id="topbar-farming-current">0</span>/<span id="topbar-farming-needed">100</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats (Gold & Energy) -->
    <div class="topbar-stats">
      <div class="topbar-stat topbar-gold">
        <div class="topbar-stat-header">
          <span class="topbar-stat-icon"><img src="./assets/sprites/ouro.png" alt="Ouro" style="width: 1.2em; height: 1.2em; vertical-align: middle;"></span>
          <span class="topbar-stat-value" id="topbar-gold">0</span>
        </div>
      </div>
      <div class="topbar-stat topbar-energy">
        <div class="topbar-stat-header">
          <span class="topbar-stat-icon">⚡</span>
          <span class="topbar-stat-value" id="topbar-energy">0/100</span>
        </div>
        <div class="topbar-energy-bar">
          <div class="topbar-energy-fill" id="topbar-energy-fill" style="width: 100%"></div>
        </div>
      </div>
    </div>

    <!-- Menu Toggle -->
    <button id="menu-toggle" class="menu-toggle" aria-label="Menu">
      <span class="hamburger"></span>
    </button>
  </div>

  <!-- Side Menu -->
  <div id="side-menu" class="side-menu">
    <div class="menu-header">
      <div class="menu-header-content">
        <div class="menu-logo">🌾</div>
        <div class="menu-title-section">
          <h2 id="menu-title">FazendaRPG</h2>
          <p class="menu-subtitle">Menu Principal</p>
        </div>
      </div>
      <button id="menu-close" class="menu-close">&times;</button>
    </div>

    <nav class="menu-nav">
      <!-- Navegação Principal -->
      <div class="menu-section">
        <h3 class="menu-section-title">🎮 Navegação</h3>

        <button class="menu-item" data-page="farm">
          <span class="menu-item-icon">
            <img src="assets/sprites/home.png" alt="Fazenda" style="width: 28px; height: 28px;">
          </span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.farm">Fazenda</span>
            <span class="menu-item-desc">Sua plantação</span>
          </div>
        </button>

        <button class="menu-item" data-page="skills">
          <span class="menu-item-icon">
            <img src="assets/sprites/skills.png" alt="Skills" style="width: 28px; height: 28px;">
          </span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.skills">Skills</span>
            <span class="menu-item-desc">Suas habilidades</span>
          </div>
        </button>

        <button class="menu-item" data-page="inventory">
          <span class="menu-item-icon">
            <img src="assets/sprites/bolsa.png" alt="Inventário" style="width: 28px; height: 28px;">
          </span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.inventory">Inventário</span>
            <span class="menu-item-desc">Seus itens</span>
          </div>
        </button>

        <button class="menu-item" data-page="wiki">
          <span class="menu-item-icon">📚</span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.wiki">Wiki</span>
            <span class="menu-item-desc">Guia completo</span>
          </div>
        </button>
      </div>

      <!-- Mundo e Interações -->
      <div class="menu-section">
        <h3 class="menu-section-title">🌍 Mundo</h3>

        <button class="menu-item" data-page="city">
          <span class="menu-item-icon city-icon">🏘️</span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.city">Cidade</span>
            <span class="menu-item-desc">Mercado e mais</span>
          </div>
        </button>

        <button class="menu-item" data-page="quests">
          <span class="menu-item-icon">
            <img src="assets/sprites/quests.png" alt="Missões" style="width: 28px; height: 28px;">
          </span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.quests">Missões</span>
            <span class="menu-item-desc">Objetivos</span>
          </div>
        </button>

        <button class="menu-item" data-page="npcs">
          <span class="menu-item-icon">
            <img src="assets/sprites/npcs.png" alt="NPCs" style="width: 28px; height: 28px;">
          </span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.npcs">NPCs</span>
            <span class="menu-item-desc">Personagens</span>
          </div>
        </button>
      </div>

      <!-- Configurações -->
      <div class="menu-section">
        <h3 class="menu-section-title">⚙️ Sistema</h3>

        <button class="menu-item" data-page="settings">
          <span class="menu-item-icon">
            <img src="assets/sprites/settings.png" alt="Configurações" style="width: 28px; height: 28px;">
          </span>
          <div class="menu-item-content">
            <span class="menu-item-title" data-i18n="menu.settings">Configurações</span>
            <span class="menu-item-desc">Ajustes</span>
          </div>
        </button>
      </div>

    </nav>
  </div>

  <!-- Overlay for menu -->
  <div id="menu-overlay" class="menu-overlay"></div>

  <!-- Main Content -->
  <main id="main-content" class="main-content">

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen active">
      <div class="welcome-card">
        <h1>🌾 FazendaRPG</h1></h1>
        <p data-i18n="welcome.subtitle">Bem-vindo ao seu RPG de Fazenda!</p>
        <div class="welcome-form">
          <label for="player-name" data-i18n="welcome.name">Digite seu nome:</label>
          <input type="text" id="player-name" maxlength="20" placeholder="Fazendeiro" />
          <button id="start-game-btn" class="btn btn-primary" data-i18n="welcome.start">Começar Aventura</button>
        </div>
        <div class="welcome-version">v0.0.13</div>
      </div>
    </div>

    <!-- Farm Screen -->
    <div id="farm-screen" class="screen">
      <div class="farm-view" id="farm-view">
        <div class="farm-header">
          <div class="farm-welcome-message">
            <button id="farm-inventory-btn" class="farm-inventory-btn" aria-label="Inventário" title="Ir para Inventário">
              <img src="assets/sprites/bolsa.png" alt="Inventário">
            </button>
            <div class="welcome-greeting">
              <span class="welcome-icon" style="width: 48px; height: 48px; display: inline-block; border-radius: 50%; overflow: hidden; border: 2px solid var(--brand-primary); vertical-align: middle;">
                <img id="farm-avatar-img" src="assets/sprites/avatars/11.png" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
              </span>
              <span class="welcome-text">Bem-vindo, <strong id="welcome-player-name">Fazendeiro</strong>!</span>
            </div>
            <h2 class="farm-subtitle" data-i18n="farm.title">Sua Fazenda</h2>
            <div class="farm-player-level">
              <span class="level-badge">
                <span class="level-icon">⭐</span>
                <span class="level-text">Nível <span id="farm-player-level">1</span></span>
              </span>
            </div>
            <p class="welcome-subtitle">🌾 Plante, colha e prospere em sua fazenda! 🚜</p>
          </div>
        </div>
        <div class="xp-bar-container" style="display: none;">
          <div class="xp-bar">
            <div id="xp-bar-fill" class="xp-bar-fill"></div>
          </div>
          <div class="xp-text">
            <span class="xp-label">Farming XP:</span>
            <span id="xp-current">0</span> / <span id="xp-needed">100</span>
          </div>
        </div>
      </div>

      <div id="farm-grid" class="farm-grid"></div>

      <div class="farm-actions">
        <button id="plant-all-btn" class="btn btn-success" data-i18n="farm.plantAll">
          <span>🌱</span> Plantar<br>Tudo
        </button>
        <button id="harvest-all-btn" class="btn btn-primary" data-i18n="farm.harvestAll">
          <span>🧺</span> Colher<br>Tudo
        </button>
      </div>
    </div>

    <!-- Skills Screen -->
    <div id="skills-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="skills.title">Suas Habilidades</h2>
      </div>
      <div id="skills-grid" class="skills-grid"></div>
    </div>

    <!-- Inventory Screen -->
    <div id="inventory-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="inventory.title">Inventário</h2>
      </div>
      <div id="inventory-grid" class="inventory-grid"></div>
    </div>

    <!-- City Screen -->
    <div id="city-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="city.title">Cidade</h2>
      </div>
      <div class="city-grid">
        <div class="city-card" data-location="market">
          <div class="city-icon">🛒</div>
          <h3 data-i18n="market.title">Mercado</h3>
          <p data-i18n="city.marketDesc">Compre e venda itens</p>
        </div>
        <div class="city-card" data-location="bank">
          <div class="city-icon">🏦</div>
          <h3 data-i18n="city.bank">Banco</h3>
          <p data-i18n="city.bankDesc">Gerencie seu dinheiro</p>
        </div>
        <div class="city-card" data-location="tavern">
          <div class="city-icon">🍺</div>
          <h3 data-i18n="city.tavern">Taverna</h3>
          <p data-i18n="city.tavernDesc">Descanse e ouça histórias</p>
        </div>
        <div class="city-card" data-location="plaza">
          <div class="city-icon">⛲</div>
          <h3 data-i18n="city.plaza">Praça</h3>
          <p data-i18n="city.plazaDesc">Centro da cidade</p>
        </div>
      </div>
    </div>

    <!-- Market Screen -->
    <div id="market-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="market.title">Mercado</h2>
      </div>
      <div id="market-grid" class="market-grid"></div>
    </div>

    <!-- Quests Screen -->
    <div id="quests-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="quests.title">Missões</h2>
      </div>
      <div id="quests-list" class="quests-list"></div>
    </div>

    <!-- NPCs Screen -->
    <div id="npcs-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="npcs.title">NPCs</h2>
      </div>
      <div id="npcs-grid" class="npcs-grid"></div>
    </div>

    <!-- Settings Screen -->
    <div id="settings-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="settings.title">Configurações</h2>
      </div>

      <div class="settings-container">
        <div class="setting-group">
          <h3 data-i18n="settings.theme">Tema</h3>
          <div class="theme-selector">
            <button class="theme-btn" data-theme="light">
              <span>☀️</span>
              <span data-i18n="settings.lightTheme">Dia</span>
            </button>
            <button class="theme-btn" data-theme="dark">
              <span>🌙</span>
              <span data-i18n="settings.darkTheme">Noite</span>
            </button>
          </div>
        </div>

        <div class="setting-group">
          <h3 data-i18n="settings.language">Idioma</h3>
          <div class="language-selector">
            <button class="lang-btn" data-lang="pt-BR">
              <span>🇧🇷</span>
              <span>Português (BR)</span>
            </button>
            <button class="lang-btn" data-lang="en-US">
              <span>🇺🇸</span>
              <span>English (US)</span>
            </button>
          </div>
        </div>

        <div class="setting-group">
          <h3 data-i18n="settings.notifications">Notificações</h3>
          <p class="setting-description" data-i18n="settings.notificationsDesc">
            Receba avisos quando seus crops estiverem prontos para colher
          </p>
          <button id="enable-notifications-btn" class="btn btn-primary" data-i18n="settings.enableNotifications">
            🔔 Ativar Notificações
          </button>
          <button id="test-notification-btn" class="btn btn-secondary" data-i18n="settings.testNotification" style="display:none;">
            🧪 Testar Notificação
          </button>
          <div id="notification-status" style="margin-top: 10px; font-size: 0.9em; color: var(--text-secondary);"></div>
        </div>

        <div class="setting-group">
          <h3 data-i18n="settings.data">Dados do Jogo</h3>
          <button id="save-file-btn" class="btn btn-secondary" data-i18n="settings.save">
            💾 Salvar Jogo
          </button>
          <button id="load-file-btn" class="btn btn-secondary" data-i18n="settings.load">
            📂 Carregar Jogo
          </button>
          <button id="reset-game-btn" class="btn btn-danger" data-i18n="settings.reset">
            🗑️ Resetar Jogo
          </button>
        </div>
      </div>
    </div>

    <!-- Wiki Screen -->
    <div id="wiki-screen" class="screen">
      <div class="screen-header">
        <h2 data-i18n="wiki.title">📚 Wiki - Guia Completo</h2>
      </div>

      <div class="wiki-container">
        <!-- Wiki Sidebar -->
        <div class="wiki-sidebar">
          <div class="wiki-search">
            <input type="text" id="wiki-search" placeholder="Buscar na Wiki..." class="wiki-search-input">
            <span class="wiki-search-icon">🔍</span>
          </div>

          <nav class="wiki-nav">
            <div class="wiki-nav-section">
              <h3 class="wiki-nav-title">🎮 Início</h3>
              <button class="wiki-nav-item active" data-wiki-page="getting-started">
                <span class="wiki-nav-icon">🌱</span>
                <span>Primeiros Passos</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="game-mechanics">
                <span class="wiki-nav-icon">⚙️</span>
                <span>Como Jogar</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="energy-system">
                <span class="wiki-nav-icon">⚡</span>
                <span>Sistema de Energia</span>
              </button>
            </div>

            <div class="wiki-nav-section">
              <h3 class="wiki-nav-title">🌾 Farming</h3>
              <button class="wiki-nav-item" data-wiki-page="crops">
                <span class="wiki-nav-icon">🌽</span>
                <span>Cultivos</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="tools">
                <span class="wiki-nav-icon">🔧</span>
                <span>Ferramentas</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="fertilizer">
                <span class="wiki-nav-icon">🌿</span>
                <span>Fertilizantes</span>
              </button>
            </div>

            <div class="wiki-nav-section">
              <h3 class="wiki-nav-title">⭐ Skills</h3>
              <button class="wiki-nav-item" data-wiki-page="skills-system">
                <span class="wiki-nav-icon">📊</span>
                <span>Sistema de Skills</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="leveling">
                <span class="wiki-nav-icon">🎯</span>
                <span>Níveis e XP</span>
              </button>
            </div>

            <div class="wiki-nav-section">
              <h3 class="wiki-nav-title">📦 Itens</h3>
              <button class="wiki-nav-item" data-wiki-page="items-guide">
                <span class="wiki-nav-icon">🎒</span>
                <span>Guia de Itens</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="all-items">
                <span class="wiki-nav-icon">📋</span>
                <span>Lista Completa</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="inventory">
                <span class="wiki-nav-icon">👜</span>
                <span>Inventário</span>
              </button>
            </div>

            <div class="wiki-nav-section">
              <h3 class="wiki-nav-title">🏘️ Cidade</h3>
              <button class="wiki-nav-item" data-wiki-page="market">
                <span class="wiki-nav-icon">🏪</span>
                <span>Mercado</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="npcs-guide">
                <span class="wiki-nav-icon">👥</span>
                <span>NPCs</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="quests">
                <span class="wiki-nav-icon">📜</span>
                <span>Missões</span>
              </button>
            </div>

            <div class="wiki-nav-section">
              <h3 class="wiki-nav-title">💡 Dicas</h3>
              <button class="wiki-nav-item" data-wiki-page="tips">
                <span class="wiki-nav-icon">💎</span>
                <span>Dicas e Truques</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="strategies">
                <span class="wiki-nav-icon">🎯</span>
                <span>Estratégias</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="faq">
                <span class="wiki-nav-icon">❓</span>
                <span>Perguntas Frequentes</span>
              </button>
              <button class="wiki-nav-item" data-wiki-page="updates">
                <span class="wiki-nav-icon">📰</span>
                <span>Atualizações</span>
              </button>
            </div>
          </nav>
        </div>

        <!-- Wiki Content - Dynamically generated by WikiManager -->
        <div class="wiki-content">
          <div class="wiki-loading">
            <p>Carregando conteúdo da wiki...</p>
          </div>
        </div>
      </div>
    </div>


  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-row">
      <div class="footer-brand">
        <span class="footer-game-name">🌾 FazendaRPG</span>
        <span class="footer-copyright">© 2025</span>
      </div>
      <div class="footer-dev">
        <span class="footer-dev-text" data-i18n="footer.developed">Desenvolvido por:</span>
        <a href="https://gennisys.com" target="_blank" rel="noopener noreferrer" class="gennisys-badge">
          <span class="gennisys-text">Gennisys</span>
        </a>
      </div>
      <div class="footer-version-card">
        <span class="version-number">v0.0.13</span>
      </div>
    </div>
  </footer>

  <!-- Avatar Selection Modal -->
  <div id="avatar-modal" class="modal-container">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2>Escolha seu Avatar</h2>
        <button class="modal-close-btn" id="avatar-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="avatar-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto;">
          <!-- Avatars will be dynamically loaded here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Container -->
  <div id="modal-container" class="modal-container"></div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p data-i18n="loading">Carregando...</p>
  </div>

  <!-- Scripts -->
  <script type="module" src="js/app.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('✅ Service Worker registered'))
          .catch(err => console.error('❌ SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
